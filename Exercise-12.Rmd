---
title: "Exercise 12"
author: "Lili Benitez"
date: "2024-04-19"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(naniar)
f<-"https://raw.githubusercontent.com/difiore/ada-2024-datasets/main/Mammal_lifehistories_v2.txt"
d<-read_tsv(f)
replace_with_na_all(d,   condition = ~.x == -999)
d<-d%>%
  select(-`litter size`, refs)

d_log<-d%>%
  mutate(across(where(is.numeric), log))

```

## Regression: 
Regress the (now log transformed) age [gestation(mo), weaning(mo), AFR(mo) (age at first reproduction), and max. life(mo) (maximum lifespan)] and mass [newborn(g) and wean mass(g)] variables on (now log transformed) overall body mass(g) and add the residuals to the dataframe as new variables (relGest, relWean, relAFR, relLife, relNewbornMass, and relWeaningMass).
```{r}
d_log<-d_log%>%
  mutate(mass=`mass(g)`, 
         weaning=`weaning(mo)`, 
         gestation)
m_gest<-lm(data=d_log, mass~`gestation(mo)`, na.action = na.exclude)# not padding NAs
relGest<-resid(m_gest)
m_w<-lm(data=d_log, mass~`weaning(mo)`, na.action=na.exclude)
relWean<-resid(m_w)
m_AFR<-lm(data=d_log, mass~`AFR(mo)`, na.action=na.exclude)
relAFR<-resid(m_AFR)
m_life<-lm(data=d_log, mass~`max. life(mo)`, na.action=na.exclude)
relLife<-resid(m_life)
m_new<-lm(data=d_log, mass~`newborn(g)`, na.action=na.exclude)
relNewbornMass<-resid(m_new)
m_w_m<-lm(data=d_log, mass~`wean mass(g)`, na.action=na.exclude)
relWeaningMass<-resid(m_w_m)

d_log<-d_log%>%
  mutate(relGest=relGest, 
        relWean=relWean,
        relAFR=relAFR,
        relLife=relLife,
        relNewbornMass=relNewbornMass,
        relWeaningMass=relWeaningMass )

```

## Step 5
Plot residuals of max lifespan (relLife) in relation to Order. Which mammalian orders have the highest residual lifespan?
Plot residuals of newborn mass (relNewbornMass) in relation to Order. Which mammalian orders have the have highest residual newborn mass?
Plot residuals of weaning mass (relWeaningMass) in relation to Order. Which mammalian orders have the have highest relative weaning mass?
```{r}
ggplot(data=d_log, aes(x=order, y=relLife))+
  geom_boxplot()+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

ggplot(data=d_log, aes(x=order, y=relNewbornMass))+
  geom_boxplot()+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

ggplot(data=d_log, aes(x=order, y=relWeaningMass))+
  geom_boxplot()+
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```
Cetacea, Atiodactyla, Sirenia, and Perissodactyla, Proboscidea, have the highest residual life spans. Carnivora, Lagomorpha, Perissodactyla, Proboscidea, Tubulindentata have the highest residual newborn mass, although the latter seem to be data deficient. Sirenia, Tubulidentat, Xenarthra, Hyracooidea(these four data defic), Pholidota,Lagomorpha, Carnivora (very variable), have the highest relative weaning mass. 
## Step 6
Run models and a model selection process to evaluate what (now log transformed) variables best predict each of the two response variables, max. life(mo) and AFR(mo), from the set of the following predictors: gestation(mo), newborn(g), weaning(mo), wean mass(g), litters/year, and overall body mass(g).
HINT: Before running models, winnow your dataset to drop rows that are missing the respective response variable or any of the predictors, e.g., by using drop_na().

For each of the two response variables, indicate what is the best model overall based on AICc and how many models have a delta AICc of 4 or less?
What variables, if any, appear in all of this set of “top” models?
Calculate and plot the model-averaged coefficients and their CIs across this set of top models.

```{r}

```


